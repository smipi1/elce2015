
configurable support for ELF core dumps


 tiny-mpm/fs/binfmt_elf.c |    4 ++--
 tiny-mpm/init/Kconfig    |    6 ++++++
 2 files changed, 8 insertions(+), 2 deletions(-)

Index: tiny/fs/binfmt_elf.c
===================================================================
--- tiny.orig/fs/binfmt_elf.c	2005-10-10 17:30:45.000000000 -0700
+++ tiny/fs/binfmt_elf.c	2005-10-10 17:42:36.000000000 -0700
@@ -58,7 +58,7 @@ extern int dump_fpu (struct pt_regs *, e
  * If we don't support core dumping, then supply a NULL so we
  * don't even try.
  */
-#ifdef USE_ELF_CORE_DUMP
+#if defined(USE_ELF_CORE_DUMP) && defined(CONFIG_ELF_CORE)
 static int elf_core_dump(long signr, struct pt_regs * regs, struct file * file);
 #else
 #define elf_core_dump	NULL
@@ -1109,7 +1109,7 @@ out:
  * Note that some platforms still use traditional core dumps and not
  * the ELF core dump.  Each platform can select it as appropriate.
  */
-#ifdef USE_ELF_CORE_DUMP
+#if defined(USE_ELF_CORE_DUMP) && defined(CONFIG_ELF_CORE)
 
 /*
  * ELF core dumper
Index: tiny/init/Kconfig
===================================================================
--- tiny.orig/init/Kconfig	2005-10-10 17:42:34.000000000 -0700
+++ tiny/init/Kconfig	2005-10-10 17:42:36.000000000 -0700
@@ -355,6 +355,12 @@ config FULL_PANIC
           Disabling compiles out the explanations for panics, saving
 	  string space. Use with caution.
 
+config ELF_CORE
+	default y
+	bool "Enable ELF core dumps" if EMBEDDED
+	help
+	  Enable support for generating core dumps. Disabling saves about 4k.
+
 config BASE_FULL
 	default y
 	bool "Enable full-sized data structures for core" if EMBEDDED
