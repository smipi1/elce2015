
configurable netdev multicast support code


 include/linux/netdevice.h |   13 	12 +	1 -	0 !
 init/Kconfig              |    7 	7 +	0 -	0 !
 net/core/Makefile         |    3 	2 +	1 -	0 !
 3 files changed, 21 insertions(+), 2 deletions(-)

Index: linux-2.6.23-rc9/include/linux/netdevice.h
===================================================================
--- linux-2.6.23-rc9.orig/include/linux/netdevice.h	2007-10-09 00:24:10.000000000 +0200
+++ linux-2.6.23-rc9/include/linux/netdevice.h	2007-10-09 00:24:13.000000000 +0200
@@ -1094,8 +1094,19 @@
 extern void		__dev_set_rx_mode(struct net_device *dev);
 extern int		dev_unicast_delete(struct net_device *dev, void *addr, int alen);
 extern int		dev_unicast_add(struct net_device *dev, void *addr, int alen);
+#ifdef CONFIG_NET_DEV_MULTICAST
 extern int 		dev_mc_delete(struct net_device *dev, void *addr, int alen, int all);
 extern int		dev_mc_add(struct net_device *dev, void *addr, int alen, int newonly);
+extern void		dev_mcast_init(void);
+#else
+#define	dev_mc_upload(a)
+static inline int dev_mc_delete(struct net_device *dev,
+				void *addr, int alen, int all) { return 0; }
+static inline int dev_mc_add(struct net_device *dev,
+			     void *addr, int alen, int newonly) { return 0; }
+#define dev_mcast_init()
+#endif
+
 extern int		dev_mc_sync(struct net_device *to, struct net_device *from);
 extern void		dev_mc_unsync(struct net_device *to, struct net_device *from);
 extern int 		__dev_addr_delete(struct dev_addr_list **list, int *count, void *addr, int alen, int all);
@@ -1106,7 +1117,6 @@
 extern void		netdev_features_change(struct net_device *dev);
 /* Load a device via the kmod */
 extern void		dev_load(const char *name);
-extern void		dev_mcast_init(void);
 extern int		netdev_max_backlog;
 extern int		weight_p;
 extern int		netdev_set_master(struct net_device *dev, struct net_device *master);
Index: linux-2.6.23-rc9/init/Kconfig
===================================================================
--- linux-2.6.23-rc9.orig/init/Kconfig	2007-10-09 00:24:10.000000000 +0200
+++ linux-2.6.23-rc9/init/Kconfig	2007-10-09 00:29:53.000000000 +0200
@@ -385,6 +385,13 @@
 	  This enables the basic kernel level socket filtering, not to
 	  be confused with netfilter. Required by PPP.
 
+config NET_DEV_MULTICAST
+	default y
+	depends NET
+	bool "Enable device multicast support" if EMBEDDED
+	help
+	  This enables the core device multicast list management code.
+
 config MEASURE_INLINES
 	default n
 	bool "Enable inline measurement" if EMBEDDED
Index: linux-2.6.23-rc9/net/core/Makefile
===================================================================
--- linux-2.6.23-rc9.orig/net/core/Makefile	2007-10-09 00:24:10.000000000 +0200
+++ linux-2.6.23-rc9/net/core/Makefile	2007-10-09 00:24:13.000000000 +0200
@@ -7,7 +7,7 @@
 
 obj-$(CONFIG_SYSCTL) += sysctl_net_core.o
 
-obj-y		     += dev.o dev_mcast.o dst.o netevent.o \
+obj-y		     += dev.o dst.o netevent.o \
 			neighbour.o rtnetlink.o utils.o link_watch.o
 
 obj-$(CONFIG_XFRM) += flow.o
@@ -17,4 +17,5 @@
 obj-$(CONFIG_NETPOLL) += netpoll.o
 obj-$(CONFIG_NET_DMA) += user_dma.o
 obj-$(CONFIG_FIB_RULES) += fib_rules.o
+obj-$(CONFIG_NET_DEV_MULTICAST) += dev_mcast.o
 obj-$(CONFIG_NET_SK_FILTER) += filter.o
